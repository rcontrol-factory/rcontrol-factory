<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>RControl Factory</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />

  <!-- Seguran√ßa b√°sica (CSP) -->
  <meta http-equiv="Content-Security-Policy"
    content="
      default-src 'self';
      img-src 'self' data:;
      style-src 'self' 'unsafe-inline';
      script-src 'self' https://cdn.jsdelivr.net 'unsafe-inline';
      connect-src 'self';
      frame-src 'self';
      base-uri 'self';
      form-action 'self';
    " />
</head>
<body>
  <header class="top">
    <div class="brand">
      <div class="dot"></div>
      <div>
        <div class="title">RControl Factory</div>
        <div class="sub">Factory interna ‚Ä¢ PWA ‚Ä¢ Offline-first</div>
        <div class="sub" style="opacity:.75">
          <a href="./privacy.html" style="color:inherit;text-decoration:underline">Privacidade</a>
          ‚Ä¢
          <a href="./terms.html" style="color:inherit;text-decoration:underline">Termos</a>
        </div>
      </div>
    </div>

    <nav class="tabs">
      <button class="tab active" data-tab="dashboard">Dashboard</button>
      <button class="tab" data-tab="newapp">New App</button>
      <button class="tab" data-tab="editor">Editor</button>
      <button class="tab" data-tab="generator">Generator</button>
      <button class="tab" data-tab="agent">Agente</button>
      <button class="tab" data-tab="settings">Settings</button>
      <button class="tab" data-tab="admin">Admin</button>
    </nav>
  </header>

  <main class="wrap">

    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="panel">
      <h2>Bem-vindo üëã</h2>
      <p class="muted">Crie apps e publique depois (primeiro vamos estabilizar).</p>

      <div class="row">
        <button class="btn" id="goNewApp">+ Criar novo app</button>
        <button class="btn ghost" id="goEditor">Abrir Editor</button>
        <button class="btn ghost" id="goGenerator">Gerar ZIP</button>
        <button class="btn ghost" id="goAgent">Agente</button>
      </div>

      <h3>Apps salvos</h3>
      <div id="appsList" class="list"></div>

      <h3>Status</h3>
      <div id="statusBox" class="status">Pronto ‚úÖ</div>
    </section>

    <!-- NEW APP -->
    <section id="tab-newapp" class="panel hidden">
      <h2>Criar novo app</h2>
      <div class="row">
        <input id="newName" class="input" placeholder="Nome (ex: RQuotas)" />
        <input id="newId" class="input" placeholder="ID (ex: rquotas)" />
      </div>

      <div class="row">
        <select id="newType" class="select">
          <option value="pwa">pwa</option>
        </select>

        <select id="newTemplate" class="select"></select>

        <button id="createAppBtn" class="btn">Criar</button>
        <button id="cancelNew" class="btn danger ghost">Cancelar</button>
      </div>

      <pre id="newAppValidation" class="pre">OK ‚úÖ</pre>
    </section>

    <!-- EDITOR -->
    <section id="tab-editor" class="panel hidden">
      <h2>Editor</h2>
      <p class="muted">Edite os arquivos do app ativo e veja o preview.</p>

      <div class="row">
        <span class="pill">App ativo: <strong id="activeAppLabel">‚Äî</strong></span>
        <button id="openPreviewBtn" class="btn ghost">üëÅ Preview</button>
      </div>

      <div class="row">
        <button id="saveFileBtn" class="btn">Salvar arquivo</button>
        <button id="resetFileBtn" class="btn danger ghost">Reset arquivo</button>
      </div>

      <h3>Arquivos</h3>
      <div id="filesList" class="files"></div>

      <div class="row">
        <span class="muted">Arquivo atual:</span>
        <strong id="currentFileLabel">index.html</strong>
      </div>

      <textarea id="codeArea" class="textarea" spellcheck="false"></textarea>

      <h3>Preview</h3>
      <iframe id="previewFrame" class="preview" title="preview"></iframe>
    </section>

    <!-- GENERATOR -->
    <section id="tab-generator" class="panel hidden">
      <h2>Generator</h2>
      <p class="muted">Gera ZIP do app ativo (offline-first). Publish entra depois.</p>

      <div class="row">
        <select id="genAppSelect" class="select"></select>
        <button id="downloadZipBtn" class="btn">üì¶ Gerar ZIP</button>
        <button id="publishBtn" class="btn ghost">üöÄ Publish (depois)</button>
      </div>

      <div class="row">
        <a id="publishedLink" class="muted" href="#" target="_blank" rel="noopener">‚Äî</a>
        <button id="copyLinkBtn" class="btn ghost">Copiar link</button>
      </div>

      <div id="genStatus" class="status">Status: pronto ‚úÖ</div>
    </section>

    <!-- AGENTE (FORA DO ADMIN) -->
    <section id="tab-agent" class="panel hidden">
      <h2>Agente (Criador de Apps)</h2>
      <p class="muted">
        Aqui √© a IA ‚Äúoper√°ria‚Äù: cria apps, cria telas e estrutura os projetos (RQuotas primeiro).<br/>
        Seguran√ßa: pra rodar, voc√™ precisa desbloquear o Admin (PIN) ‚Äî por enquanto.
      </p>

      <div class="card">
        <div class="muted" style="margin-bottom:8px">
          Exemplos: <code>criar app RQuotas</code> ‚Ä¢ <code>listar apps</code> ‚Ä¢ <code>selecionar rquotas</code>
        </div>

        <textarea id="agentInput" class="textarea mini" placeholder="Digite um comando..."></textarea>

        <div class="row">
          <button id="agentRunBtn" class="btn">Executar</button>
          <button id="agentClearBtn" class="btn ghost">Limpar</button>
          <button id="agentApplyBtn" class="btn ghost">Aplicar sugest√£o</button>
          <button id="agentDiscardBtn" class="btn danger ghost">Descartar</button>
        </div>

        <pre id="agentOut" class="pre">‚Äî</pre>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="panel hidden">
      <h2>Settings</h2>
      <p class="muted">Configura√ß√µes locais (Supabase entra na etapa do app).</p>

      <div class="grid">
        <label class="lbl">GitHub user</label>
        <input id="ghUser" class="input" placeholder="ex: seuuser" />

        <label class="lbl">GitHub token</label>
        <input id="ghToken" class="input" placeholder="(depois)" />

        <label class="lbl">Repo prefix</label>
        <input id="repoPrefix" class="input" value="rapp-" />

        <label class="lbl">Pages base</label>
        <input id="pagesBase" class="input" placeholder="https://SEUUSER.github.io" />
      </div>

      <div class="row">
        <button id="saveSettingsBtn" class="btn">Salvar</button>
        <button id="resetFactoryBtn" class="btn danger">Reset Factory</button>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="tab-admin" class="panel hidden">
      <h2>Admin</h2>
      <p class="muted">Diagn√≥stico + backup + mini-IA interna (com aprova√ß√£o).</p>

      <div class="card">
        <div class="row">
          <input id="adminPinInput" class="input" placeholder="PIN (padr√£o 1122) | emerg√™ncia: 0000" />
          <button id="adminUnlockBtn" class="btn">Unlock 15min</button>
          <span id="adminState" class="badge">LOCKED üîí</span>
        </div>
      </div>

      <div class="card">
        <h3>Diagn√≥stico</h3>
        <div class="row">
          <button id="diagBtn" class="btn ghost">Gerar diagn√≥stico</button>
          <button id="copyDiagBtn" class="btn ghost">Copiar diagn√≥stico</button>
          <button id="clearPwaBtn" class="btn danger">Limpar Cache PWA</button>
        </div>
        <pre id="adminOut" class="pre">‚Äî</pre>
      </div>

      <div class="card">
        <h3>Backup</h3>
        <div class="row">
          <button id="exportBtn" class="btn ghost">Exportar backup</button>
          <button id="importBtn" class="btn ghost">Importar backup</button>
        </div>
        <div class="muted">Export salva JSON do localStorage (apps + settings).</div>
      </div>

      <div class="card">
        <h3>IA Admin (Estruturar Factory)</h3>
        <div class="muted">Essa IA √© pra manuten√ß√£o/upgrade da Factory (n√£o pra construir apps finais).</div>

        <textarea id="aiInput" class="textarea mini" placeholder="Ex: help | status | list | export | diag"></textarea>

        <div class="row">
          <button id="aiRunBtn" class="btn">Executar</button>
          <button id="aiClearBtn" class="btn ghost">Limpar</button>
          <button id="aiApplyBtn" class="btn ghost">Aplicar sugest√£o</button>
          <button id="aiDiscardBtn" class="btn danger ghost">Descartar</button>
        </div>

        <pre id="aiOut" class="pre">‚Äî</pre>
      </div>
    </section>

  </main>

  <!-- libs -->
  <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>

  <!-- m√≥dulos -->
  <script src="./js/ai.builder.js"></script>

  <!-- app principal -->
  <script src="./app.js"></script>

  <script src="./js/ui.gear.js"></script>

  <script src="./js/ui.topbar.js"></script>

  <!-- service worker register (fixo) -->
  <script>
    if ("serviceWorker" in navigator) {
      window.addEventListener("load", async () => {
        try {
          const v = "2026-02-09-v3";
          await navigator.serviceWorker.register("./sw.js?v=" + v);
        } catch (e) {}
      });
    }
  </script>
</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>RControl Factory</title>

  <!-- CSS local -->
  <link rel="stylesheet" href="/app/styles.css" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <!-- Sem cache chato (ajuda iOS) -->
  <meta http-equiv="Cache-Control" content="no-store" />
  <meta http-equiv="Pragma" content="no-cache" />
</head>

<body>
  <!-- Fallback de boot (se JS quebrar você vê) -->
  <pre id="bootlog" style="margin:0;padding:12px;font:12px ui-monospace,Menlo,monospace;color:#bfe;opacity:.9">
Boot: carregando…
  </pre>

  <div id="app"></div>

  <!-- CORE primeiro -->
  <script src="/app/app.js"></script>

  <!-- (opcionais) seus módulos -->
  <script src="/app/js/router.js"></script>
  <script src="/app/js/admin.js"></script>

  <script src="/app/js/core/vfs_overrides.js"></script>
  <script src="/app/js/core/thompson.js"></script>
  <script src="/app/js/core/github_sync.js"></script>
  <script src="/app/js/core/mother_selfupdate.js"></script>

  <!-- SW REGISTER (SAFE) -->
  <script>
    (function () {
      var boot = document.getElementById("bootlog");
      function log(x){ if(boot) boot.textContent += x + "\n"; }

      log("Boot: scripts vão carregar…");

      if (!("serviceWorker" in navigator)) {
        log("SW: navegador sem suporte.");
        return;
      }

      window.addEventListener("load", async () => {
        try {
          // ✅ scope certo: /app/
          const reg = await navigator.serviceWorker.register("/app/sw.js", { scope: "/app/" });
          log("SW: registrado ✅ scope=/app/");

          // Se não tiver controller, pede 1 reload e pronto
          if (!navigator.serviceWorker.controller) {
            log("SW: sem controller (1º load). Recarregue 1x.");
          }
        } catch (e) {
          log("SW ERRO: " + (e && e.message ? e.message : String(e)));
          console.warn("SW erro:", e);
        }
      });
    })();
  </script>

  <script>
    // some com bootlog quando o app montar
    setTimeout(() => {
      var el = document.getElementById("bootlog");
      if (el) el.style.display = "none";
    }, 2500);
  </script>
</body>
</html>

<!doctype html>
<html lang="pt-br">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <meta name="theme-color" content="#0b1220" />
  <title>RControl Factory</title>

  <link rel="manifest" href="/app/manifest.json" />
  <link rel="stylesheet" href="/app/styles.css" />

  <!-- iOS PWA -->
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

  <style>
    /* FIX iOS: checkbox/label clicável e sem overlay fantasma */
    label[for] { cursor: pointer; }
    input[type="checkbox"]{
      width: 22px; height: 22px;
      accent-color: #22c55e;
      -webkit-tap-highlight-color: transparent;
    }
    .rcf-clickfix { pointer-events: auto !important; }
  </style>
</head>

<body>
  <noscript>Ative o JavaScript para usar a Factory.</noscript>

  <!-- Root -->
  <div id="app" class="rcf-clickfix"></div>

  <!-- Core (estável) -->
  <script defer src="/app/app.js"></script>

  <!-- Router / UI (se existirem no seu projeto) -->
  <script defer src="/app/js/router.js"></script>
  <script defer src="/app/js/ui.topbar.js"></script>
  <script defer src="/app/js/ui.gear.js"></script>

  <!-- Admin / Mãe -->
  <script defer src="/app/js/admin.js"></script>

  <!-- Core modules (pastas core) -->
  <script defer src="/app/js/core/thompson.js"></script>
  <script defer src="/app/js/core/mother_selfupdate.js"></script>
  <script defer src="/app/js/core/github_sync.js"></script>
  <script defer src="/app/js/core/publish_queue.js"></script>

  <!-- Agent (se existir) -->
  <script defer src="/app/js/agent.router.js"></script>
  <script defer src="/app/js/agent.nlp.js"></script>

  <!-- SW register -->
  <script>
    (function(){
      if (!("serviceWorker" in navigator)) return;
      window.addEventListener("load", async () => {
        try {
          // IMPORTANTE: único SW é /app/sw.js
          const reg = await navigator.serviceWorker.register("/app/sw.js", { scope: "/app/" });
          // opcional: força atualizar quando abrir
          reg.update?.();
        } catch (e) {
          console.warn("SW register falhou:", e);
        }
      });
    })();
  </script>
</body>
</html>

<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>RControl Factory</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <div id="appShell">
    <!-- TOP BAR (sempre clic√°vel) -->
    <header id="topbar" class="topbar">
      <div class="brand">
        <span class="dot"></span>
        <div class="brandText">
          <div class="brandTitle">RControl Factory</div>
          <div class="brandSub">Factory interna ‚Ä¢ PWA ‚Ä¢ Offline-first</div>
          <div class="brandLinks">
            <a href="privacy.html" target="_blank" rel="noopener">Privacidade</a> ‚Ä¢
            <a href="terms.html" target="_blank" rel="noopener">Termos</a>
          </div>
        </div>
      </div>

      <nav class="navTop" aria-label="Navega√ß√£o">
        <button class="pill" data-nav="dashboard">Dashboard</button>
        <button class="pill" data-nav="newapp">New App</button>
        <button class="pill" data-nav="editor">Editor</button>
        <button class="pill" data-nav="generator">Generator</button>
        <button class="pill" data-nav="agent">Agente</button>
        <button class="pill" data-nav="settings">Settings</button>
        <button class="pill" data-nav="admin">Admin</button>

        <div class="spacer"></div>

        <span id="statusBadge" class="badge ok">OK ‚úÖ</span>
        <button id="toolsBtn" class="iconBtn" title="Ferramentas (Diag/Logs)">
          ‚öôÔ∏è
        </button>
      </nav>
    </header>

    <!-- MAIN -->
    <main class="main">
      <!-- DASHBOARD -->
      <section class="card" data-page="dashboard">
        <h1>Bem-vindo üëã</h1>
        <p class="muted">Crie apps e publique depois (primeiro vamos estabilizar).</p>

        <div class="row">
          <button class="btn primary" id="btnCreateApp">+ Criar novo app</button>
          <button class="btn" id="btnOpenEditor">Abrir Editor</button>
          <button class="btn" id="btnZip">Gerar ZIP</button>
        </div>

        <div class="sectionTitle">Apps salvos</div>
        <div id="appsList" class="list"></div>

        <div class="sectionTitle">Status</div>
        <div class="statusBox">
          <span id="statusText">Pronto ‚úÖ</span>
        </div>
      </section>

      <!-- NEW APP -->
      <section class="card hidden" data-page="newapp">
        <h1>Novo App</h1>
        <p class="muted">Cria um app (pasta) com arquivos b√°sicos (PWA + UI).</p>

        <div class="formRow">
          <label>Nome do app</label>
          <input id="newAppName" placeholder="Ex: RQuotas" />
        </div>
        <div class="formRow">
          <label>Slug (id)</label>
          <input id="newAppSlug" placeholder="Ex: rquotas" />
          <div class="hint">Sem espa√ßo, s√≥ letras/n√∫meros e h√≠fen.</div>
        </div>

        <div class="row">
          <button class="btn primary" id="createNow">Criar</button>
          <button class="btn" data-nav="dashboard">Voltar</button>
        </div>
      </section>

      <!-- EDITOR -->
      <section class="card hidden" data-page="editor">
        <h1>Editor</h1>
        <p class="muted">Edite arquivos do app ativo e salve.</p>

        <div class="pillBox">
          <span class="muted">App ativo:</span>
          <strong id="activeAppLabel">‚Äî</strong>
          <button class="btn sm" id="btnPreview">üëÅÔ∏è Preview</button>
        </div>

        <div class="row">
          <button class="btn primary" id="btnSaveFile">Salvar arquivo</button>
          <button class="btn danger" id="btnResetFile">Reset arquivo</button>
        </div>

        <div class="editorGrid">
          <div>
            <div class="sectionTitle">Arquivos</div>
            <div id="filesList" class="list"></div>
          </div>

          <div>
            <div class="sectionTitle">Arquivo atual: <span id="fileNameLabel">‚Äî</span></div>
            <textarea id="fileEditor" spellcheck="false"></textarea>
          </div>
        </div>
      </section>

      <!-- GENERATOR -->
      <section class="card hidden" data-page="generator">
        <h1>Generator</h1>
        <p class="muted">Gera/exporta arquivos do app ativo (por enquanto b√°sico).</p>

        <div class="row">
          <button class="btn" id="exportBackup">Exportar backup</button>
          <button class="btn" id="importBackup">Importar backup</button>
          <input id="importBackupFile" type="file" accept="application/json" hidden />
        </div>

        <div class="hint">
          * ‚ÄúZIP‚Äù real a gente coloca depois (sem biblioteca ainda). Por enquanto exporta JSON e voc√™ consegue guardar/transferir.
        </div>
      </section>

      <!-- SETTINGS -->
      <section class="card hidden" data-page="settings">
        <h1>Settings</h1>
        <div class="formRow">
          <label>Session / Modo</label>
          <select id="modeSelect">
            <option value="private">Privado (Factory)</option>
            <option value="dev">Dev (mais logs)</option>
          </select>
        </div>

        <div class="formRow">
          <label>Senha Admin (local)</label>
          <input id="adminPin" placeholder="Ex: 000" />
          <div class="hint">Salva no aparelho (localStorage). N√£o √© ‚Äúseguran√ßa real‚Äù, √© s√≥ bloqueio local.</div>
        </div>

        <button class="btn primary" id="saveSettings">Salvar</button>
      </section>
    </main>
  </div>

  <!-- MODAL: AGENT -->
  <div id="agentModal" class="modalOverlay hidden" aria-hidden="true">
    <div class="modal">
      <div class="modalHead">
        <div>
          <div class="modalTitle">AGENT ‚Ä¢ Criador de Apps</div>
          <div class="muted small">Voc√™ d√° comandos. Ele monta uma sugest√£o (patch) e voc√™ aprova.</div>
        </div>
        <button class="btn sm" data-close="agentModal">Fechar</button>
      </div>

      <div class="modalBody">
        <div class="hint">
          Comandos r√°pidos: <code>help</code> ‚Ä¢ <code>list</code> ‚Ä¢ <code>create RQuotas rquotas</code> ‚Ä¢
          <code>select rquotas</code> ‚Ä¢ <code>open editor</code> ‚Ä¢ <code>set file app.js</code> ‚Ä¢ <code>write</code> ‚Ä¢
          <code>inject asset</code>
        </div>

        <textarea id="agentInput" placeholder="Digite um comando... (ex: create AgroControl agrocontrol)"></textarea>

        <div class="row">
          <button class="btn primary" id="agentRun">Executar</button>
          <button class="btn" id="agentClear">Limpar</button>
          <button class="btn ok" id="agentApprove">Aprovar sugest√£o</button>
          <button class="btn danger" id="agentDiscard">Descartar sugest√£o</button>
          <button class="btn" id="agentUpload">Upload arquivo</button>
          <input id="agentUploadInput" type="file" accept="image/*,application/pdf" hidden />
        </div>

        <div class="cardMini">
          <div class="sectionTitle">Resultado</div>
          <pre id="agentOutput" class="pre"></pre>
        </div>

        <div class="sectionTitle">Vault (arquivos guardados)</div>
        <div class="muted small">Voc√™ pode guardar PDF/foto e depois injetar no app ativo como asset.</div>
        <div id="vaultList" class="list"></div>
      </div>
    </div>
  </div>

  <!-- MODAL: ADMIN -->
  <div id="adminModal" class="modalOverlay hidden" aria-hidden="true">
    <div class="modal">
      <div class="modalHead">
        <div>
          <div class="modalTitle">ADMIN ‚Ä¢ IA Offline v2 (70%)</div>
          <div class="muted small">Ajuda a atualizar a Factory (corrigir UI, melhorar a√ß√µes). Voc√™ aprova manualmente.</div>
        </div>
        <button class="btn sm" data-close="adminModal">Fechar</button>
      </div>

      <div class="modalBody">
        <textarea id="adminInput" placeholder="Ex: mover bot√µes para topo, remover dock, colocar engrenagem com ferramentas..."></textarea>

        <div class="row">
          <button class="btn primary" id="adminRun">Executar</button>
          <button class="btn" id="adminClear">Limpar</button>
          <button class="btn ok" id="adminApply">Aplicar sugest√£o</button>
          <button class="btn danger" id="adminDiscard">Descartar</button>
        </div>

        <div class="cardMini">
          <div class="sectionTitle">Plano + Sugest√£o</div>
          <pre id="adminOutput" class="pre"></pre>
        </div>
      </div>
    </div>
  </div>

  <!-- TOOLS PANEL (‚öôÔ∏è) -->
  <div id="toolsPanel" class="toolsPanel hidden" aria-hidden="true">
    <div class="toolsHead">
      <strong>Ferramentas</strong>
      <button class="btn sm" id="toolsClose">Fechar</button>
    </div>

    <div class="toolsBody">
      <div class="row">
        <button class="btn" id="btnClearLogs">Limpar logs</button>
        <button class="btn" id="btnCopyLogs">Copiar logs</button>
        <button class="btn" id="btnCopyDiag">Copiar diagn√≥stico</button>
      </div>

      <div class="row">
        <button class="btn danger" id="btnClearCache">Limpar Cache PWA</button>
        <button class="btn" id="btnOpenAgent">Abrir Agent</button>
        <button class="btn" id="btnOpenAdmin">Abrir Admin</button>
      </div>

      <div class="cardMini">
        <div class="sectionTitle">Logs</div>
        <pre id="logsBox" class="pre"></pre>
      </div>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>

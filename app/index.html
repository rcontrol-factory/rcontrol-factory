<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>RControl Factory</title>
  <meta name="theme-color" content="#0b1220" />
  <link rel="manifest" href="manifest.json" />
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header class="topbar">
    <div class="brand">
      <span class="dot"></span>
      <div class="brandText">
        <div class="brandTitle">RControl Factory</div>
        <div class="brandSub">Factory interna ‚Ä¢ PWA ‚Ä¢ Offline-first</div>
      </div>
    </div>

    <nav class="nav">
      <button class="tabBtn" data-tab="dashboard">Dashboard</button>
      <button class="tabBtn" data-tab="newapp">New App</button>
      <button class="tabBtn" data-tab="editor">Editor</button>
      <button class="tabBtn" data-tab="generator">Generator</button>
      <button class="tabBtn" data-tab="settings">Settings</button>
      <button class="tabBtn" data-tab="admin">Admin</button>

      <div class="navRight">
        <span id="statusPill" class="pill ok">OK ‚úÖ</span>
        <button id="gearBtn" class="gear" aria-label="Ferramentas">‚öôÔ∏è</button>
      </div>
    </nav>
  </header>

  <main class="wrap">
    <!-- DASHBOARD -->
    <section id="tab-dashboard" class="tab">
      <div class="card">
        <h1>Bem-vindo üëã</h1>
        <p class="muted">Crie apps e publique depois (primeiro vamos estabilizar).</p>

        <div class="row">
          <button class="btn primary" id="btnCreateQuick">+ Criar novo app</button>
          <button class="btn" id="btnGoEditor">Abrir Editor</button>
          <button class="btn" id="btnExportBackup">Exportar backup</button>
        </div>

        <h2>Apps salvos</h2>
        <div id="appsList" class="appsList"></div>

        <h2>Status</h2>
        <div class="statusBox">
          <span>Pronto ‚úÖ</span>
        </div>
      </div>
    </section>

    <!-- NEW APP -->
    <section id="tab-newapp" class="tab hidden">
      <div class="card">
        <h1>Novo App</h1>
        <p class="muted">Crie um app (slug sem espa√ßo). Ex: <b>RQuotas</b> / <b>rquotas</b></p>

        <div class="form">
          <label>Nome</label>
          <input id="newName" placeholder="RQuotas" />
          <label>Slug</label>
          <input id="newSlug" placeholder="rquotas" />
          <button class="btn primary" id="btnCreate">Criar</button>
        </div>
      </div>
    </section>

    <!-- EDITOR -->
    <section id="tab-editor" class="tab hidden">
      <div class="card">
        <h1>Editor</h1>
        <p class="muted">Edite arquivos do app ativo e veja o preview.</p>

        <div class="row between">
          <div class="muted">App ativo: <b id="activeAppLabel">‚Äî</b></div>
          <div class="row">
            <button class="btn" id="btnPreview">üëÅÔ∏è Preview</button>
            <button class="btn primary" id="btnSaveFile">Salvar arquivo</button>
            <button class="btn danger" id="btnResetFile">Reset arquivo</button>
          </div>
        </div>

        <div class="grid">
          <div class="filesCol">
            <h2>Arquivos</h2>
            <div id="filesList" class="filesList"></div>
            <div class="muted small">Arquivo atual: <b id="currentFileLabel">‚Äî</b></div>
          </div>

          <div class="editorCol">
            <textarea id="fileEditor" spellcheck="false"></textarea>
          </div>
        </div>

        <div id="previewWrap" class="previewWrap hidden">
          <iframe id="previewFrame" title="Preview"></iframe>
        </div>
      </div>
    </section>

    <!-- GENERATOR -->
    <section id="tab-generator" class="tab hidden">
      <div class="card">
        <h1>Generator</h1>
        <p class="muted">Export do app ativo (JSON). ZIP real d√° pra colocar depois.</p>
        <div class="row">
          <button class="btn primary" id="btnExportApp">Exportar app (JSON)</button>
          <button class="btn" id="btnImportBackup">Importar backup</button>
        </div>
        <p class="muted small">Obs: ‚ÄúImportar backup‚Äù abre seletor de arquivo JSON.</p>
        <input id="importInput" type="file" accept="application/json" class="hidden"/>
      </div>
    </section>

    <!-- SETTINGS -->
    <section id="tab-settings" class="tab hidden">
      <div class="card">
        <h1>Settings</h1>
        <p class="muted">Modo da Factory: <b id="modeLabel">private</b></p>
        <div class="row">
          <button class="btn" id="btnSetPrivate">Private</button>
          <button class="btn" id="btnSetPublic">Public</button>
        </div>
      </div>
    </section>

    <!-- ADMIN -->
    <section id="tab-admin" class="tab hidden">
      <div class="card">
        <h1>Admin</h1>
        <p class="muted">Aqui √© o ‚ÄúAdmin/IA‚Äù pra sugerir corre√ß√µes na Factory (voc√™ aprova manual).</p>
        <div class="row">
          <button class="btn primary" id="btnOpenAdmin">Abrir Admin IA</button>
          <button class="btn" id="btnDiag">Gerar diagn√≥stico</button>
        </div>
        <pre id="diagBox" class="codeBox"></pre>
      </div>
    </section>
  </main>

  <!-- TOOLS MENU (engrenagem) -->
  <div id="toolsMenu" class="toolsMenu hidden">
    <div class="toolsCard">
      <div class="row between">
        <b>Ferramentas</b>
        <button class="btn small" id="btnCloseTools">Fechar</button>
      </div>
      <div class="row wrap">
        <button class="btn" id="btnClearLogs">Limpar logs</button>
        <button class="btn" id="btnCopyLogs">Copiar logs</button>
        <button class="btn" id="btnCopyDiag">Copiar diagn√≥stico</button>
        <button class="btn danger" id="btnClearCache">Limpar Cache PWA</button>
      </div>
      <pre id="logsBox" class="codeBox"></pre>
    </div>
  </div>

  <!-- MODAL: AGENT (Criador de apps) -->
  <div id="agentModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="row between">
        <div>
          <div class="modalTitle">AGENT ‚Ä¢ Criador de Apps</div>
          <div class="muted small">Voc√™ d√° comandos. Ele monta uma sugest√£o (patch) e voc√™ aprova.</div>
        </div>
        <button class="btn small" data-close="agentModal">Fechar</button>
      </div>

      <div class="muted small">Comandos: <b>help</b> ‚Ä¢ <b>list</b> ‚Ä¢ <b>create NOME slug</b> ‚Ä¢ <b>select slug</b> ‚Ä¢ <b>open editor</b> ‚Ä¢ <b>set file app.js</b> ‚Ä¢ <b>write ...</b></div>

      <textarea id="agentInput" class="modalInput" placeholder="Digite um comando... (ex: create RQuotas rquotas)"></textarea>

      <div class="row">
        <button class="btn primary" id="btnAgentRun">Executar</button>
        <button class="btn" id="btnAgentClear">Limpar</button>
      </div>

      <h3>Resultado</h3>
      <pre id="agentOutput" class="codeBox"></pre>
    </div>
  </div>

  <!-- MODAL: ADMIN IA -->
  <div id="adminModal" class="modal hidden" role="dialog" aria-modal="true">
    <div class="modalCard">
      <div class="row between">
        <div>
          <div class="modalTitle">ADMIN ‚Ä¢ IA Offline v2 (70%)</div>
          <div class="muted small">Ajuda a atualizar a Factory (corrigir UI, melhorar a√ß√µes). Voc√™ aprova manualmente.</div>
        </div>
        <button class="btn small" data-close="adminModal">Fechar</button>
      </div>

      <textarea id="adminInput" class="modalInput" placeholder="Ex: mover bot√µes para topo, remover dock, colocar engrenagem com ferramentas..."></textarea>

      <div class="row">
        <button class="btn primary" id="btnAdminPlan">Gerar plano + sugest√£o</button>
        <button class="btn" id="btnAdminClear">Limpar</button>
      </div>

      <h3>Plano + Sugest√£o</h3>
      <pre id="adminOutput" class="codeBox"></pre>

      <div class="row">
        <button class="btn primary" id="btnApplySuggestion">Aplicar sugest√£o (gera patch)</button>
        <button class="btn danger" id="btnDiscardSuggestion">Descartar</button>
      </div>
      <pre id="patchBox" class="codeBox"></pre>
    </div>
  </div>

  <script src="app.js"></script>
</body>
</html>
